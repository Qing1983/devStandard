# 微服务
## 什么是微服务
微服务是项目中的一个相对较小、功能独立的程序。

每个微服务都可以采用不同的存储方式甚至不同的编程语言，数据库也是单个模块对应自己的数据库。
比如A微服务使用mysql, B微服务使用pgsql。

## 如何拆分微服务
微服务可以按照业务功能本身的独立性来划分。
拆分的大原则是当一块业务不依赖或极少依赖其它服务，有独立的业务语义，为超过2个的其他服务或客户端提供数据，那么它就应该被拆分成一个独立的服务模块。


## 微服务设计原则
- **单一职责原则**

```
意思是每个微服务只需要实现自己的业务逻辑就可以了，比如订单管理模块，它只需要处理订单的业务逻辑就可以了，其它的不必考虑。
```

- **服务自治原则**  

```
意思是每个微服务从开发、测试、运维等都是独立的，包括存储的数据库也都是独立的，自己就有一套完整的流程，我们完全可以把它当成一个项目来对待。不必依赖于其它模块。
```

- **轻量级通信原则**

```
首先是通信的语言非常的轻量，第二，该通信方式需要是跨语言、跨平台的，之所以要跨平台、跨语言就是为了让每个微服务都有足够的独立性，可以不受技术的钳制。
```

- **接口明确原则**

```
由于微服务之间可能存在着调用关系，为了尽量避免以后由于某个微服务的接口变化而导致其它微服务都做调整，在设计之初就要考虑到所有情况，让接口尽量做的更通用，更灵活，从而尽量避免其它模块也做调整。
```

##服务发现

当微服务多起来了以后，原来的一个项目就被拆成了N个微服务。

这个时候我们遇到了新问题，客户端的一个接口，往往需要调用N个微服务。

客户端必须要知道这N个微服务的网络位置(IP:PORT)。

以往的做法是把服务的位置写到配置文件里面，或者配置在数据库里面。

这里就有一些问题：

- 首先我们需要配置N个服务的网络位置，配置起来繁琐复杂
- 其次每次服务的网络位置发生变化，都需要改变每个调用者的配置
- 最后当一个服务性能不够，需要扩充的时候，很难扩充

总结起来一句话：服务多了，配置很麻烦，问题很多。

这个时候有人想了一个办法，如果提供一个查询服务的服务器，每次一个新的微服务启动的时候，就把自己的网络位置(IP:PORT)发送给这台服务器。客户端只要使用服务名就可以在服务器上找到对应的微服务进行调用。

服务0-N把当前自己的网络位置发送给服务发现服务器，服务发现服务器就以K-V的方式记录下，K一般是服务名，V就是IP:PORT。

服务发现服务器定时的轮询查看这些服务能不能访问的了（这就是健康检查）。

客户端在调用服务0-N的时候，就跑去服务发现服务器查一下它的网络位置，然后再调用它们的服务。

这样客户端就不需要记录这些微服务网络位置了，只需要记住服务名，不管后续微服务网络位置怎么变，也还是可以正常调用，客户端和服务端完全解耦！

服务管理中心
目前主要有4种服务管理中心。


consul是分布式的、高可用、横向扩展的。
consul提供的一些关键特性：

	- service discovery：consul通过DNS或者HTTP接口使服务注册和服务发现变的很容易，一些外部服务，例如saas提供的也可以一样注册。
	- health checking：健康检测使consul可以快速的告警在集群中的操作。和服务发现的集成，可以防止服务转发到故障的服务上面。
	- key/value storage：一个用来存储动态配置的系统。提供简单的HTTP接口，可以在任何地方操作。
	- multi-datacenter：无需复杂的配置，即可支持任意数量的区域。

consul由一个个节点(agent)组成,每个节点启动的时候可以指定是用Server启动还是Client启动。

不管是SERVER还是CLIENT，所有的服务都可以注册到这些节点上。

CLIENT
CLIENT表示consul的client模式，就是客户端模式。是consul节点的一种模式，这种模式下，所有注册到当前节点的服务会被转发到SERVER，本身是不持久化这些信息。

SERVER
SERVER表示consul的server模式，表明这个consul是个server，这种模式下，功能和CLIENT都一样，唯一不同的是，它会把所有的信息持久化的本地，这样遇到故障，信息是可以被保留的。

SERVER-LEADER
中间那个SERVER下面有LEADER的字眼，表明这个SERVER是它们的老大，它和其它SERVER不一样的一点是，它需要负责同步注册的信息给其它的SERVER，同时也要负责各个节点的健康监测。



# 单机Docker启动

# 集群Docker启动






